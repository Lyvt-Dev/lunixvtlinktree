<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Password Generator - Calmly</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet" />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  />
  <link rel="stylesheet" href="../assets/css/language-modal.css" />
  <script src="https://cdn.jsdelivr.net/npm/tsparticles@2.11.1/tsparticles.bundle.min.js"></script>
  <link rel="stylesheet" href="../assets/css/settings.css" />
  <link rel="stylesheet" href="../assets/css/gen.css" />
</head>
<body>
  <div id="settings-button" title="Settings">
    <i class="fas fa-cog"></i>
  </div>

  <!-- Background Music -->
  <audio id="background-music" loop>
    <source src="../assets/background.mp3" type="audio/mpeg">
  </audio>

  <div id="tsparticles"></div>


  <div class="container">
    <nav>
      <a href="index.html" class="fade-in" style="--delay: 0.1s">Home</a>
      <a href="gen.html" class="fade-in" style="--delay: 0.15s">Passwort Generator</a>
      <a href="speedtest.html" class="fade-in" style="--delay: 0.1s">Speed Test</a>
      <a href="listanime.html" class="fade-in" style="--delay: 0.25s">Anime List</a>
    </nav>

    <h1 class="fade-in" style="--delay: 0.2s">
      <span style="--delay: 0.3s">Passwortgenerator</span>
      <span style="--delay: 0.4s">&</span>
      <span style="--delay: 0.5s">Prüfer</span>
    </h1>
    <p class="subtitle fade-in" style="--delay: 0.6s">Generieren Sie ein sicheres Passwort oder testen Sie Ihre eigene Passwortstärke!</p>

    <div class="card fade-in" style="--delay: 0.7s" role="main" aria-label="Password generator and checker">

      <input
        type="text"
        id="passwordDisplay"
        placeholder="Ihr generiertes Passwort oder fügen Sie hier ein"
        aria-describedby="strengthText"
        aria-label="Password input"
      />

      <div>
        <button id="generateBtn" aria-label="Generate a random password">Passwort generieren</button>
        <div class="button-container">
          <button id="copyBtn" aria-label="Copy password to clipboard">Passwort kopieren</button>
          <div id="copy-toast">Kopiert!</div>
        </div>
      </div>

      <div id="strengthMeter" aria-hidden="true"><div></div></div>
      <div id="strengthText" aria-live="polite" aria-atomic="true">Passwort Stärke: N/A</div>
    </div>
  </div>

  <footer class="fade-in" style="--delay: 0.8s">
    <p>&copy; 2025 Luca. Made with <i class="fas fa-heart"></i> in Germany.</p>
    <p style="margin-top: 0.5rem;">Besucher: <span id="visitor-count">...</span></p>
  </footer>

  <script>

    tsParticles.load("tsparticles", {
      background: { color: { value: "transparent" } },
      fpsLimit: 60,
      interactivity: {
        detectsOn: "canvas",
        events: {
          onHover: { enable: true, mode: "grab" },
          onClick: { enable: true, mode: "push" },
        },
        modes: {
          grab: { distance: 150, links: { opacity: 0.7 } },
          push: { quantity: 4 },
        },
      },
      particles: {
        color: { value: "#3b82f6" },
        links: { enable: true, color: "#3b82f6", distance: 140, opacity: 0.4, width: 1 },
        move: { enable: true, speed: 1.3, outModes: { default: "out" }, random: true, straight: false },
        number: { value: 60, density: { enable: true, area: 800 } },
        opacity: { value: 0.5 },
        shape: { type: "circle" },
        size: { value: { min: 2, max: 4 } },
      },
      detectRetina: true,
    });

    function generatePassword(length = 16) {
      const charset = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()_-+=<>?";
      let password = "";
      for (let i = 0; i < length; i++) {
        password += charset.charAt(Math.floor(Math.random() * charset.length));
      }
      return password;
    }

    function checkStrength(password) {
      let score = 0;
      if (!password) return score;
      if (password.length >= 8) score += 20;
      if (password.length >= 12) score += 20;
      if (password.length >= 16) score += 20;
      if (/[a-z]/.test(password)) score += 15;
      if (/[A-Z]/.test(password)) score += 15;
      if (/\d/.test(password)) score += 15;
      if (/[!@#$%^&*()_\-+=<>?]/.test(password)) score += 15;

      if (score > 100) score = 100;
      return score;
    }

    function updateStrengthMeter(score) {
      const meterBar = document.querySelector("#strengthMeter > div");
      meterBar.style.width = score + "%";
      let color = "red";
      let text = "Sehr Schwach";

      if (score >= 80) {
        color = "#22c55e"; 
        text = "Sehr Stark";
      } else if (score >= 60) {
        color = "#a3e635";
        text = "Stark";
      } else if (score >= 40) {
        color = "#facc15";
        text = "Mittel Stark";
      } else if (score >= 20) {
        color = "#f97316";
        text = "Schwach";
      }

      meterBar.style.backgroundColor = color;
      document.getElementById("strengthText").textContent = `Passwort Stärke: ${text}`;
    }

    document.getElementById("generateBtn").addEventListener("click", () => {
      const pw = generatePassword(16);
      const input = document.getElementById("passwordDisplay");
      input.value = pw;
      const strength = checkStrength(pw);
      updateStrengthMeter(strength);
    });

    document.getElementById("copyBtn").addEventListener("click", () => {
      const input = document.getElementById("passwordDisplay");
      if (!input.value) {
        return; 
      }
      navigator.clipboard.writeText(input.value).then(
        () => {
          const toast = document.getElementById('copy-toast');
          toast.style.opacity = '1';
          toast.style.visibility = 'visible';
          toast.style.transform = 'translateX(-50%) translateY(-10px)';

          setTimeout(() => {
            toast.style.opacity = '0';
            toast.style.visibility = 'hidden';
            toast.style.transform = 'translateX(-50%)';
          }, 2000);
        },
        () => {
          alert("Kopieren des Passworts fehlgeschlagen. Bitte versuchen Sie es erneut.");
        }
      );
    });

    fetch('https://api.visitors.watch/v1/hit/calmly-dev.xyz/visits')
      .then(response => response.json())
      .then(data => {
        document.getElementById('visitor-count').innerText = data.data.value;
      })
      .catch((error) => {
        console.error('Error fetching visitor count:', error);
        document.getElementById('visitor-count').innerText = 'N/A';
      });

    document.getElementById("passwordDisplay").addEventListener("input", (e) => {
      const val = e.target.value;
      const strength = checkStrength(val);
      updateStrengthMeter(strength);
    });
  </script>
  <script src="../js/language-modal.js"></script>
  <script src="../js/settings.js"></script>
</body>
</html>
